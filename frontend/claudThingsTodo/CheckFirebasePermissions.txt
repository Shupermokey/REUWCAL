rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Default lock-down
    match /{document=**} {
      allow read, write: if false;
    }

    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      match /properties/{propertyId} {
        allow read, write: if request.auth.uid == userId;

				match /details/{detailId} {
        	allow read, write: if request.auth.uid == userId;
        }
				
        match /fileSystem/{folderId} {
          allow read, write: if request.auth.uid == userId;
        }
        
        match /files/{fileId}{
          allow read, write: if request.auth.uid == userId;
        }

        match /fileSystem/{document=**} {
          allow read, write: if request.auth.uid == userId;
        }

        match /scenarioRows/{scenarioRowId} {
          allow read, write: if request.auth.uid == userId;
        }

        match /rows/{rowId} {
          allow read, write: if request.auth.uid == userId;
        }

        // ✅ NEW: Allow incomeStatement/statement read/write
        match /incomeStatement/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        match /propertyTaxes/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        match /grossSiteArea/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        match /grossBuildingArea/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        match /purchasePrice/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        match /financing/{docId} {
          allow read, write: if request.auth.uid == userId;
        }
        // ✅ NEW: Allow units subcollection read/write
  			match /units/{docId} {
    			allow read, write: if request.auth.uid == userId;
  			}
      }

      match /baselines/{baselineId} {
        allow read, write: if request.auth.uid == userId;
      }

      // ----- Zoning Categories -----
  match /zoningCategories/{categoryId} {
    allow read: if request.auth.uid == userId;
    
      // ✅ Allow adding new subtypes always
  allow create: if request.auth.uid == userId;

    // Only allow writes if not a protected default
    allow write, update, delete: if request.auth.uid == userId
      && !("isDefault" in resource.data && resource.data.isDefault == true);
  }

      // ----- Zoning Subtypes -----
  match /zoningSubtypes/{categoryLabel}/{subtypeId} {
    allow read: if request.auth.uid == userId;
    
      // ✅ Allow adding new subtypes always
  allow create: if request.auth.uid == userId;

    // Same rule for subtypes of default categories
    allow write, update, delete: if request.auth.uid == userId
      && !("isDefault" in resource.data && resource.data.isDefault == true);
  }
    }

    match /customers/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      match /subscriptions/{subscriptionId} {
        allow read, write: if request.auth.uid == userId;
      }
    }

    match /products/{productId} {
      allow read: if true;
      match /prices/{priceId} {
        allow read: if true;
      }
    }
  }
}
